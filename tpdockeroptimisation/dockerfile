# Step 3 : sécurité et finalisation
FROM node:20-alpine

WORKDIR /app

# Copier uniquement package*.json pour le cache
COPY package*.json ./

# Installer uniquement dépendances de production
RUN npm ci --omit=dev

# Copier le reste de l’application
COPY . .

# Exposer uniquement le port principal
EXPOSE 3000

# Définir environnement production
ENV NODE_ENV=production

# Sécurité : utiliser un utilisateur non-root
USER node

# Commande de démarrage
CMD ["node", "server.js"]
