# Step 1 : cache et dépendances
FROM node:18-slim

WORKDIR /app

# Copier uniquement package.json et package-lock.json pour tirer parti du cache
COPY package*.json ./

# Installer uniquement les dépendances de production
RUN npm ci --omit=dev

# Copier le reste de l’application
COPY . .

# Exposer le port principal
EXPOSE 3000

# Définir l'environnement de production
ENV NODE_ENV=production

# Utiliser l'utilisateur non-root fourni par l'image
USER node

# Commande de démarrage
CMD ["node", "server.js"]
